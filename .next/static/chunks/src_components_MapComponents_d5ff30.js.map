{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/ttigg/Documents/GitHub/ufps-web/src/components/MapComponents.js"],"sourcesContent":["'use client'\r\n\r\nimport { useEffect, useCallback, useRef } from 'react'\r\nimport L from 'leaflet'\r\nimport 'leaflet/dist/leaflet.css'\r\n\r\nconst WALAILAK_COORDS = [8.6407383, 99.8985493]\r\nconst DEFAULT_ZOOM = 16.5\r\nconst SEARCH_DELAY = 500\r\nconst MIN_SEARCH_LENGTH = 3\r\n\r\nconst MapComponent = () => {\r\n  const mapRef = useRef(null)\r\n  const markersRef = useRef([])\r\n  const searchTimeoutRef = useRef(null)\r\n\r\n  // Handle location selection\r\n  const goToLocation = useCallback((lat, lon, name) => {\r\n    if (!mapRef.current) return\r\n\r\n    mapRef.current.setView([lat, lon], DEFAULT_ZOOM)\r\n    \r\n    // Clear existing markers\r\n    markersRef.current.forEach(marker => marker.remove())\r\n    markersRef.current = []\r\n    \r\n    // Add new marker\r\n    const newMarker = L.marker([lat, lon])\r\n      .addTo(mapRef.current)\r\n      .bindPopup(`<b>${name}</b>`)\r\n      .openPopup()\r\n    \r\n    markersRef.current.push(newMarker)\r\n    \r\n    // Clear search\r\n    const searchInput = document.getElementById('searchInput')\r\n    const searchResults = document.getElementById('searchResults')\r\n    if (searchResults) searchResults.innerHTML = ''\r\n    if (searchInput) searchInput.value = ''\r\n  }, [])\r\n\r\n  // Handle search input\r\n  const handleSearch = useCallback(async (query) => {\r\n    const searchResults = document.getElementById('searchResults')\r\n    if (!searchResults) return\r\n\r\n    if (query.length < MIN_SEARCH_LENGTH) {\r\n      searchResults.innerHTML = ''\r\n      return\r\n    }\r\n\r\n    searchResults.innerHTML = '<div class=\"p-2 text-gray-500 text-sm\">กำลังค้นหา...</div>'\r\n\r\n    try {\r\n      const response = await fetch(\r\n        `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`\r\n      )\r\n      const data = await response.json()\r\n\r\n      if (data.length === 0) {\r\n        searchResults.innerHTML = '<div class=\"p-2 text-gray-500 text-sm\">ไม่พบผลการค้นหา</div>'\r\n        return\r\n      }\r\n\r\n      searchResults.innerHTML = data\r\n        .slice(0, 5)\r\n        .map(result => `\r\n          <div \r\n            class=\"p-2 hover:bg-gray-100 cursor-pointer text-sm\" \r\n            onclick=\"window.goToLocation(${result.lat}, ${result.lon}, '${result.display_name.replace(/'/g, \"\\\\'\")}')\"\r\n          >\r\n            ${result.display_name}\r\n          </div>\r\n        `)\r\n        .join('')\r\n    } catch (error) {\r\n      console.error('Search error:', error)\r\n      searchResults.innerHTML = '<div class=\"p-2 text-red-500 text-sm\">เกิดข้อผิดพลาดในการค้นหา</div>'\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    // Initialize map if not already initialized\r\n    if (!mapRef.current) {\r\n      const mapInstance = L.map('map', {\r\n        zoomControl: false,\r\n        attributionControl: false // Hide attribution initially\r\n      }).setView(WALAILAK_COORDS, DEFAULT_ZOOM)\r\n      \r\n      mapRef.current = mapInstance\r\n\r\n      // Add zoom control\r\n      L.control.zoom({\r\n        position: 'bottomright'\r\n      }).addTo(mapInstance)\r\n\r\n      // Add attribution control (bottom-left, more compact)\r\n      L.control.attribution({\r\n        position: 'bottomleft',\r\n        prefix: 'Leaflet | © OpenStreetMap'\r\n      }).addTo(mapInstance)\r\n\r\n      // Add tile layer\r\n      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n        maxZoom: 19\r\n      }).addTo(mapInstance)\r\n\r\n      // Add initial Walailak marker\r\n      const initialMarker = L.marker(WALAILAK_COORDS)\r\n        .addTo(mapInstance)\r\n        .bindPopup(\"<b>มหาวิทยาลัยวลัยลักษณ์</b>\")\r\n        .openPopup()\r\n      \r\n      markersRef.current = [initialMarker]\r\n\r\n      // Add search control\r\n      const searchControl = L.control({ position: 'topright' })\r\n      searchControl.onAdd = function() {\r\n        const div = L.DomUtil.create('div', 'leaflet-control leaflet-bar')\r\n        div.innerHTML = `\r\n          <div class=\"p-2 bg-white rounded-lg shadow-lg\" style=\"min-width: 200px;\">\r\n            <input \r\n              type=\"text\" \r\n              id=\"searchInput\" \r\n              placeholder=\"ค้นหาสถานที่...\" \r\n              class=\"w-full px-2 py-1 text-sm border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500\"\r\n            />\r\n            <div id=\"searchResults\" class=\"mt-1 max-h-40 overflow-y-auto bg-white rounded-lg\"></div>\r\n          </div>\r\n        `\r\n        return div\r\n      }\r\n      searchControl.addTo(mapInstance)\r\n\r\n      // Prevent map zoom when scrolling over search results\r\n      const searchContainer = document.querySelector('.leaflet-control-container')\r\n      if (searchContainer) {\r\n        searchContainer.addEventListener('wheel', (e) => {\r\n          if (e.target.closest('#searchResults')) {\r\n            e.stopPropagation()\r\n          }\r\n        })\r\n      }\r\n\r\n      // Set up search input handler\r\n      const searchInput = document.getElementById('searchInput')\r\n      if (searchInput) {\r\n        searchInput.addEventListener('input', (e) => {\r\n          if (searchTimeoutRef.current) {\r\n            clearTimeout(searchTimeoutRef.current)\r\n          }\r\n          searchTimeoutRef.current = setTimeout(() => handleSearch(e.target.value), SEARCH_DELAY)\r\n        })\r\n\r\n        // Prevent map movement when interacting with search\r\n        L.DomEvent.disableClickPropagation(searchInput)\r\n        L.DomEvent.disableScrollPropagation(searchInput)\r\n      }\r\n\r\n      // Add global location handler\r\n      window.goToLocation = goToLocation\r\n\r\n      // Handle resize\r\n      const handleResize = () => {\r\n        mapInstance.invalidateSize()\r\n        // Adjust heights of search results based on window size\r\n        const searchResults = document.getElementById('searchResults')\r\n        if (searchResults) {\r\n          const windowHeight = window.innerHeight\r\n          searchResults.style.maxHeight = `${Math.min(windowHeight * 0.3, 160)}px`\r\n        }\r\n      }\r\n      window.addEventListener('resize', handleResize)\r\n      handleResize() // Initial call\r\n\r\n      // Cleanup function\r\n      return () => {\r\n        window.removeEventListener('resize', handleResize)\r\n        delete window.goToLocation\r\n        if (searchTimeoutRef.current) {\r\n          clearTimeout(searchTimeoutRef.current)\r\n        }\r\n        if (mapRef.current) {\r\n          mapRef.current.remove()\r\n          mapRef.current = null\r\n        }\r\n        markersRef.current = []\r\n      }\r\n    }\r\n  }, [goToLocation, handleSearch])\r\n\r\n  return (\r\n    <div \r\n      id=\"map\" \r\n      className=\"w-full h-full\"\r\n      style={{\r\n        position: 'relative',\r\n        zIndex: 0\r\n      }}\r\n    />\r\n  )\r\n}\r\n\r\nexport default MapComponent"],"names":[],"mappings":"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"}},
    {"offset": {"line": 226, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}